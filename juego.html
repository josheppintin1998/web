import pygame
import random
import os

pygame.init()
pygame.mixer.init()

ANCHO = 600
ALTO = 400
TAM_BLOQUE = 20

pantalla = pygame.display.set_mode((ANCHO, ALTO))
pygame.display.set_caption("Snake Pro ðŸðŸ”¥")

reloj = pygame.time.Clock()
FUENTE = pygame.font.SysFont("arial", 25)

# Colores
NEGRO = (0, 0, 0)
VERDE = (0, 255, 0)
ROJO = (255, 0, 0)
BLANCO = (255, 255, 255)

# Sonido al girar
sonido_giro = pygame.mixer.Sound("giro.wav")

# Archivo para rÃ©cord
ARCHIVO_RECORD = "record.txt"

def cargar_record():
    if os.path.exists(ARCHIVO_RECORD):
        with open(ARCHIVO_RECORD, "r") as f:
            return int(f.read())
    return 0

def guardar_record(puntos):
    with open(ARCHIVO_RECORD, "w") as f:
        f.write(str(puntos))

def dibujar_serpiente(tam, lista):
    for bloque in lista:
        pygame.draw.rect(pantalla, VERDE, [bloque[0], bloque[1], tam, tam])

def mensaje(texto, color, x, y):
    msg = FUENTE.render(texto, True, color)
    pantalla.blit(msg, [x, y])

def juego():
    fin = False
    game_over = False

    x = ANCHO // 2
    y = ALTO // 2

    dx = 0
    dy = 0

    serpiente = []
    largo_serpiente = 1

    comida_x = random.randrange(0, ANCHO - TAM_BLOQUE, TAM_BLOQUE)
    comida_y = random.randrange(0, ALTO - TAM_BLOQUE, TAM_BLOQUE)

    record = cargar_record()

    while not fin:

        while game_over:
            pantalla.fill(NEGRO)
            mensaje("Perdiste ðŸ˜¢  R = Reintentar  Q = Salir", ROJO, 80, ALTO // 3)
            mensaje(f"RÃ©cord: {record}", BLANCO, 220, ALTO // 2)
            pygame.display.update()

            for evento in pygame.event.get():
                if evento.type == pygame.QUIT:
                    fin = True
                    game_over = False
                if evento.type == pygame.KEYDOWN:
                    if evento.key == pygame.K_q:
                        fin = True
                        game_over = False
                    if evento.key == pygame.K_r:
                        juego()

        for evento in pygame.event.get():
            if evento.type == pygame.QUIT:
                fin = True
            if evento.type == pygame.KEYDOWN:
                if evento.key == pygame.K_LEFT and dx == 0:
                    dx = -TAM_BLOQUE
                    dy = 0
                    sonido_giro.play()
                elif evento.key == pygame.K_RIGHT and dx == 0:
                    dx = TAM_BLOQUE
                    dy = 0
                    sonido_giro.play()
                elif evento.key == pygame.K_UP and dy == 0:
                    dy = -TAM_BLOQUE
                    dx = 0
                    sonido_giro.play()
                elif evento.key == pygame.K_DOWN and dy == 0:
                    dy = TAM_BLOQUE
                    dx = 0
                    sonido_giro.play()

        # Choque con paredes
        if x >= ANCHO or x < 0 or y >= ALTO or y < 0:
            game_over = True

        x += dx
        y += dy
        pantalla.fill(NEGRO)

        pygame.draw.rect(pantalla, ROJO, [comida_x, comida_y, TAM_BLOQUE, TAM_BLOQUE])

        cabeza = [x, y]
        serpiente.append(cabeza)

        if len(serpiente) > largo_serpiente:
            del serpiente[0]

        # Choque consigo misma
        for bloque in serpiente[:-1]:
            if bloque == cabeza:
                game_over = True

        dibujar_serpiente(TAM_BLOQUE, serpiente)

        puntos = largo_serpiente - 1
        mensaje(f"Puntaje: {puntos}", BLANCO, 10, 10)
        mensaje(f"RÃ©cord: {record}", BLANCO, 400, 10)

        pygame.display.update()

        # Comer comida
        if x == comida_x and y == comida_y:
            comida_x = random.randrange(0, ANCHO - TAM_BLOQUE, TAM_BLOQUE)
            comida_y = random.randrange(0, ALTO - TAM_BLOQUE, TAM_BLOQUE)
            largo_serpiente += 1

        # Guardar rÃ©cord si se supera
        if puntos > record:
            record = puntos
            guardar_record(record)

        reloj.tick(10)

    pygame.quit()
    quit()

juego()